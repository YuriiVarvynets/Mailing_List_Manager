<!doctype html>
<html lang=''>
<head>
   {% load staticfiles %}
   <meta charset='utf-8'>
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="stylesheet" href="{% static 'css/menu_styles.css' %}">
    <script src="{% static 'scripts/menu-jquery-latest.js' %}" type="text/javascript"></script>

   <link rel="stylesheet" href="{% static 'bootstrap_table/src/bootstrap-table.css' %}">
   <script src="{% static 'bootstrap_table/src/bootstrap-table.js' %}"></script>
   <script src="{% static 'bootstrap_table/src/locale/bootstrap-table-en-US.js' %}"></script>
    <script src="{% static 'bootstrap_table/src/extensions/export/bootstrap-table-export.js' %}"></script>
    <script src="{% static 'bootstrap_table/src/extensions/export/jquery.base64.js' %}"></script>
    <script src="{% static 'bootstrap_table/src/extensions/export/tableExport.js' %}"></script>

   <link href="http://netdna.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" rel="stylesheet">
   <script src="{% static 'scripts/bootstrap.js' %}" type="text/javascript"></script>
    <script type="text/javascript" src="{% static 'scripts/moment.js' %}"></script>
    <script src="{% static 'scripts/bootstrap-datetimepicker.min.js' %}" type="text/javascript"></script>
    <link href="{% static 'css/bootstrap-datetimepicker.css' %}" rel="stylesheet">

    <script type="text/javascript" src="{% static 'scripts/bootstrap-collapse.js' %}"></script>
    <script type="text/javascript" src="{% static 'scripts/bootstrap-transition.js' %}"></script>
    <link href='http://fonts.googleapis.com/css?family=Roboto:100' rel='stylesheet' type='text/css'>
    <link href="{% static 'css/my_style.css' %}" rel="stylesheet">
   <title>Mailing List Manager</title>
</head>
<body>

<div id='cssmenu'>
<ul>
   <li><a href='/Import'>Import</a></li>
   <li class="active"><a href='/Search'>Search</a></li>
</ul>
</div>

<div class="container" style="margin-top: 10px">
<form  action='#' method='post'>{% csrf_token %}
    <div class="row">
        <div class="col-md-3">
            <h1 id="h1_search">Owner Label Name:</h1>
        </div>
        <div class="col-md-9">
            {{ form.Owner_Label_Name }}
        </div>
    </div>
    <div class="row">
        <div class="col-md-3">
            <h1 id="h1_search">Property Address:</h1>
        </div>
        <div class="col-md-3">
            {{ form.Property_Address }}
        </div>
        <div class="col-md-3">
            <h1 id="h1_search">Mail Address:</h1>
        </div>
        <div class="col-md-3">
            {{ form.Mail_Address }}
        </div>
    </div>
    <div class="row">
        <div class="col-md-3">
            <h1 id="h1_search">Property City:</h1>
        </div>
        <div class="col-md-3">
            {{ form.Property_City }}
        </div>
        <div class="col-md-3">
            <h1 id="h1_search">Mail City:</h1>
        </div>
        <div class="col-md-3">
            {{ form.Mail_City }}
        </div>
    </div>
    <div class="row">
        <div class="col-md-3">
            <h1 id="h1_search">Property State:</h1>
        </div>
        <div class="col-md-3">
            {{ form.Property_State }}
        </div>
        <div class="col-md-3">
            <h1 id="h1_search">Mail State:</h1>
        </div>
        <div class="col-md-3">
            {{ form.Mail_State }}
        </div>
    </div>
    <div class="row">
        <div class="col-md-3">
            <h1 id="h1_search">Property Type:</h1>
        </div>
        <div class="col-md-3">
            {{ form.Property_Type }}
        </div>
        <div class="col-md-3">
            <h1 id="h1_search">Equity (percentage):</h1>
        </div>
        <div class="col-md-3">
            {{ form.Equity }}
        </div>
    </div>
    <div class="row">
        <div class="col-md-3">
            <h1 id="h1_search">Last Mail Date:</h1>
        </div>
        <div class="col-md-3">
            <div class='input-group date' id='datetimepicker1'>
                {{ form.Last_Mail_Date }}
                <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
                </span>
            </div>
        </div>
        <div class="col-md-3">
            <h1 id="h1_search">Absentee Owned:</h1>
        </div>
        <div class="col-md-3">
            {{ form.Absentee_Owned }}
        </div>
    </div>
    <div class="row">
        <div class="col-md-3">
            <h1 id="h1_search">Query Limit:</h1>
        </div>
        <div class="col-md-3">
            {{ form.Query_Limit }}
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <button name="query_manage_submit" class="btn btn-primary" style="width: 100%; margin-top: 15px">Query Management
                <span class="glyphicon glyphicon-menu-down"></span>
            </button>
        </div>
        <div class="col-md-6">
            <button name="search_submit" class="btn btn-primary" style="width: 100%; margin-top: 15px">Search
                <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
            </button>
        </div>
    </div>

{% if form.errors %}
    <p style="color: red;">
        Please correct the error{{ form.errors|pluralize }} below.
    </p>
    <p>
    {{ form.errors }}
    </p>
{% endif %}

{% if query_form %}

<div style="margin-top: 40px; margin-left: 0px">
    <hr style="margin-bottom: 0px">
    <div class="row">
        <div class="col-md-6">
            <h1 style="font-size: 18px">Save query</h1>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            {{ query_form.Query_Name}}
        </div>
        <div class="col-md-6">
            <button name="query_save" class="btn btn-info" style="width: 100%;">Add query
                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
            </button>
        </div>
    </div>
    <hr style="margin-bottom: 0px">
    <div class="row">
        <div class="col-md-12">
            <h1 style="font-size: 18px">Load/Remove query</h1>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            {{ query_form.Query_List}}
        </div>
        <div class="col-md-3">
            <button name="query_load" class="btn btn-info" style="width: 100%;">Load query
                <span class="glyphicon glyphicon-upload" aria-hidden="true"></span>
            </button>
        </div>
        <div class="col-md-3">
            <button name="query_remove" class="btn btn-danger" style="width: 100%;">Remove query
                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
            </button>
        </div>

    </div>
    <hr style="margin-bottom: 20px">
</div>
{% endif %}

{% if message %}
<div class="alert alert-success">
    <a href="#" class="close" data-dismiss="alert">&times;</a>
    <strong>Success!</strong> {{ message }}
</div>
{% endif %}

</form>


{% if json_data %}

    <table id="table"
           data-toolbar="#toolbar"
           data-search="true"
           data-show-refresh="true"
           data-show-toggle="true"
           data-show-columns="true"
           data-show-export="true"
>
    <thead>
    <tr>
        <th data-field="state" data-checkbox="true"></th>
        <th data-field="id" data-visible="false">id</th>
        <th data-field="Owner_Label_Name" data-sortable="true">Owner Name</th>
        <th data-field="Property_Address" data-sortable="true">Property Address</th>
        <th data-field="Property_City" data-sortable="true">Property City</th>
        <th data-field="Property_State" data-sortable="true" data-visible="false">Property State</th>
        <th data-field="Property_Type" data-sortable="true">Prop. Type</th>
        <th data-field="Mail_Address" data-sortable="true">Mail Address</th>
        <th data-field="Mail_City" data-sortable="true">Mail City</th>
        <th data-field="Mail_State" data-sortable="true" data-visible="false">Mail State</th>
        <th data-field="Equity" data-sortable="true" data-visible="false">Equity</th>
        <th data-field="Absentee_Owned" data-sortable="true" data-visible="false">Absentee Owned</th>
        <th data-field="Last_Mail_Date" data-sortable="true">Last Mail Date</th>
        <th data-field="operate"
                data-formatter="operateFormatter"
                data-events="operateEvents">Delete</th>
        </tr>
    </tr>
    </thead>
</table>

{% endif %}

{% if query_form.errors %}
    <p style="color: red;">
        Please correct the error{{ query_form.errors|pluralize }} below.
    </p>
    <p>
    {{ query_form.errors }}
    </p>
{% endif %}

</div>

<script type="text/javascript">
    $(function () {
        $('#datetimepicker1').datetimepicker({
             format: 'MM/DD/YYYY'
        });
    });
</script>

<script>

    var data = JSON.parse('{{ json_data|safe }}');
    var $table = $('#table'),
    $remove = $('#remove');

    $(function () {
        $table.bootstrapTable({
            data: data
        });

        $table.on('check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table', function () {
            $remove.prop('disabled', !$table.bootstrapTable('getSelections').length);
            alert('table on');
        });

        $remove.click(function () {
            alert('remove click');
            var ids = $.map($table.bootstrapTable('getSelections'), function (row) {
                return row.id
            });
            $table.bootstrapTable('remove', {
                field: 'id',
                values: ids
            });
            $remove.prop('disabled', true);
        });
    });
    function operateFormatter(value, row, index) {
        return [
            '<a class="remove" href="javascript:void(0)" title="Remove">',
            '<i class="glyphicon glyphicon-remove" style="padding-left: 35%"></i>',
            '</a>'
        ].join('');
    }

    window.operateEvents = {
        'click .like': function (e, value, row, index) {
            alert('You click like action, row: ' + JSON.stringify(row));
        },
        'click .remove': function (e, value, row, index) {

            var post_params = new FormData();
            post_params.append('id', [row.id]);
            post_params.append('csrfmiddlewaretoken', '{{ csrf_token }}');
            post_params.append('name', 'remove_row_from_table');

            var xhr = new XMLHttpRequest();
            var url = 'remove_row/';

            xhr.open("POST", url, true);

            //Send the proper header information along with the request
            xhr.setRequestHeader("Content-length", post_params.length);
            xhr.setRequestHeader("Connection", "close");

            xhr.onreadystatechange = function() {//Call a function when the state changes.
                if(xhr.readyState == 4 && xhr.status == 200) {
                    alert(xhr.responseText);
                }
            }
            xhr.send(post_params);

            $table.bootstrapTable('remove', {
                field: 'id',
                values: [row.id]
            });
        }
    };


</script>


</body>
</html>
